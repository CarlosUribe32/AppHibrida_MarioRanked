import kaboom from"./vendor/kaboom.mjs";window.onload=game3;let monedas=0;function game3(){const e=document.getElementById("nivel_app");let o,a,i,s,t=localStorage.getItem("personajeSeleccionado");let l,r=!0;"mario"===t?(o="marioGrande",a=.012,i=.07):"luigi"===t?(o="luigiGrande",a=.03,i=.13):"toad"===t&&(o="toadGrande",a=.079,i=.25),kaboom({global:!0,fullscreen:!0,scale:1,debug:!0,background:[0,0,0],canvas:e}),loadSprite("lvl3_bloque","./imgs/nivel2_bloque.png"),loadSprite("lvl3_piso","./imgs/nivel2_piso.png"),loadSprite("lvl2_tubo","./imgs/nivel_tubo1.png"),loadSprite("mario","./imgs/personaje_mario.png"),loadSprite("marioGrande","./imgs/personaje_mario2.png"),loadSprite("luigiGrande","./imgs/personaje_luigi2.png"),loadSprite("toadGrande","./imgs/personaje_toad2.png"),loadSprite("mario","./imgs/personaje_mario.png"),loadSprite("meta","./imgs/nivel_meta.png"),loadSprite("luigi","./imgs/personaje_luigi.png"),loadSprite("toad","./imgs/personaje_toad.png"),loadSprite("arriba","./imgs/nivel_arriba.png"),loadSprite("abajo","./imgs/nivel_abajo.png"),loadSprite("izquierda","./imgs/nivel_izquierda.png"),loadSprite("derecha","./imgs/nivel_derecha.png"),loadSprite("bloqueVacio","./imgs/nivel_bloque2.png"),loadSprite("bloqueObstaculo","./imgs/bloque2_nivel3.png"),loadSprite("flor","./imgs/nivel_flor.png"),loadSprite("tortuga","./imgs/Tortuga_nivel3.png"),loadSprite("caparazon","./imgs/caparazon_nivel3.png"),loadSprite("hongo","./imgs/nivel_hongo.png"),loadSprite("moneda","./imgs/nivel_moneda.png"),loadSprite("sorpresa","./imgs/nivel_sorpresa.png"),loadSprite("tubo","./imgs/nivel_tubo.png"),loadSprite("tubo1","./imgs/nivel_tubo1.png"),loadSprite("tubo2","./imgs/nivel_tubo2.png"),loadSprite("tubo3","./imgs/nivel_tubo3.png"),loadSprite("arriba","./imgs/nivel3_arriba.png"),loadSprite("abajo","./imgs/nivel3_abajo.png"),loadSprite("izquierda","./imgs/nivel3_izquierda.png"),loadSprite("derecha","./imgs/nivel3_derecha.png"),loadSprite("goomba","./imgs/nivel_goomba.png"),loadSprite("caparazon","./imgs/caparazon_nivel3.png"),loadSound("nivel3","./sounds/nivel3.mp3"),loadSound("nivelPerdido","./sounds/nivelPerdido.mp3"),loadSound("nivelGanado","./sounds/nivelGanado.mp3"),loadSound("salto","./sounds/salto.mp3"),loadSound("goomba","./sounds/goomba.mp3"),loadSound("coin","./sounds/moneda.mp3"),loadSound("hongoS","./sounds/hongo.mp3"),scene("game",(()=>{const n=play("nivel3",{loop:!0,volume:.5}),d=[];let p;function g(e,d){"peque単o"===e?p=add([scale(a),sprite(t),area(),solid(),pos(d),body(),c(),origin("top"),"taChikito"]):"grande"===e&&(p=add([scale(i),sprite(o),area(),solid(),pos(d),body(),c(),origin("bot"),"taGrandecito"])),p.onHeadbutt((e=>{if(e.is("moneda-sorpresa")){play("coin",{volume:.3});add([sprite("moneda"),pos(e.pos.sub(0,30)),scale(1.7),area(),solid(),lifespan(.3)]),destroy(e),add([sprite("bloqueVacio"),pos(e.pos),scale(2),area(),solid()]),monedas++,y.text=monedas}if(e.is("moneda-sorpresa-invisible")){play("coin",{volume:.3});add([sprite("moneda"),pos(e.pos.sub(0,30)),scale(1.7),area(),solid(),lifespan(.3)]),destroy(e),add([sprite("bloqueVacio"),pos(e.pos),scale(1.7),area(),solid()]),monedas+=3,y.text=monedas}e.is("hongo-sorpresa")&&(add([sprite("hongo"),pos(e.pos.sub(0,30)),scale(1.7),area(),solid(),body(),"esHongo"]),destroy(e),add([sprite("bloqueVacio"),pos(e.pos),scale(2),area(),solid()])),e.is("bloquesito")&&destroy(e)})),p.collides("esMoneda",(e=>{play("coin",{volume:.8});destroy(e),monedas+=1,y.text=monedas})),p.collides("esHongo",(e=>{play("hongoS",{volume:.8});destroy(e),p.crecer()})),p.onFall((()=>{s=!0})),p.action((()=>{p.isGrounded()&&(s=!1)})),p.action((()=>{camPos(p.pos),p.pos.y>=700&&(n.stop(),go("estadoFinal",{score:y.text,estado:"Game Over"}))})),p.collides("capa",(e=>{if(s){play("goomba",{volume:.9})}})),p.collides("peligroso",(e=>{if(s){play("goomba",{volume:.9});destroy(e),e.is("tortu")&&add([sprite("caparazon"),scale(.09),pos(e.pos),area(),solid(),body(),"capa"])}else p.is("taChikito")&&r?(n.stop(),go("estadoFinal",{score:y.text,estado:"Game Over"})):p.is("taGrandecito")&&r&&(r=!1,destroy(p),g("peque単o",p.pos),l=setTimeout((function(){r=!0}),2e3))})),p.collides("ganaste",(e=>{n.stop(),go("estadoFinal",{score:y.text,estado:"Ganaste"})}))}function c(){let e=!1;return{encoger(){destroy(p),g("peque単o",p.pos),e=!1},crecer(){destroy(p),console.log(p.pos),g("grande",p.pos),e=!0}}}function m(){if(p.isGrounded()){play("salto",{volume:.1});p.jump(850),s=!0}}e.addEventListener("touchend",(e=>{[...e.changedTouches].forEach((e=>{d.forEach((o=>{o(e.identifier,vec2(e.clientX,e.clientY).scale(.005))}))}))})),addLevel(["                          ","%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%","%                                                                                              %%   %%%%%%          %%%%      %%%%","%                                                                                              %%   %%%%%%          %%%%  g   %%%%","%                                                                                            %%          %           %    %%                 ","%                                                                                            %%          %           %    %%                                                              ","%                                                                                            %%          %           %0*  %%     gg        ttt  0000                                                                                                                %%%%%%","%                                                                   % %%%% %                 %%          %           %%%  %%  %%%%%%    tt                                !","%                                                 #                 %0%  %0%                 %%      0000%","%      *$$$                              b  b                       %%%  %%%                 %%%%    %%%%%","%                                     b  b  b  b     b                                         %%","%                                  b  b  b  b  b     b                                         %%","%                               b  b  b  b  b  b    gb  b","===========================================================================================================================================================================","==========================================================================================================================================================================="],{width:40,height:40,"=":()=>[sprite("lvl3_piso"),area(),solid()],"%":()=>[sprite("lvl3_bloque"),area(),solid(),"bloquesito"],"!":()=>[scale(.132),sprite("meta"),area(),solid(),"ganaste"],$:()=>[scale(2),sprite("sorpresa"),area(),solid(),"moneda-sorpresa"],"#":()=>[scale(2),sprite("sorpresa"),area(),solid(),opacity(0),"moneda-sorpresa-invisible"],"*":()=>[scale(2),sprite("sorpresa"),area(),solid(),"hongo-sorpresa"],t:()=>[scale(.09),sprite("tortuga"),area(),solid(),body(),"peligroso","tortu"],g:()=>[scale(1.7),sprite("goomba"),area(),solid(),body(),"peligroso"],0:()=>[scale(1.7),sprite("moneda"),area(),solid(),"esMoneda"],b:()=>[scale(1),sprite("bloqueObstaculo"),area(),solid()],"(":()=>[scale(.9),sprite("tubo2"),area(),solid()],")":()=>[scale(.9),sprite("tubo3"),area(),solid()],"-":()=>[scale(.9),sprite("tubo1"),area(),solid()],"+":()=>[scale(.9),sprite("tubo"),area(),solid()]}),g("peque単o",[90,350]),action("esHongo",(e=>{e.move(50,0)})),action("peligroso",(e=>{e.move(-60,0)}));const u=add([scale(1),sprite("arriba"),area(),fixed(),pos(150,250),opacity(.5)]),b=add([scale(1),sprite("derecha"),area(),fixed(),pos(550,250),opacity(.5)]),v=add([scale(1),sprite("izquierda"),area(),fixed(),pos(450,250),opacity(.5)]),h={left:!1,right:!1};onTouchStart(((e,o)=>{v.hasPoint(o)?(h.left=!0,v.opacity=1):b.hasPoint(o)?(h.right=!0,b.opacity=1):u.hasPoint(o)&&(m(),u.opacity=1)}));const S=(e,o)=>{v.hasPoint(o)?(h.left=!0,v.opacity=1):(h.left=!1,v.opacity=.5),b.hasPoint(o)?(h.right=!0,b.opacity=1):(h.right=!1,b.opacity=.5),u.hasPoint(o)?u.opacity=1:u.opacity=.5};onTouchMove(S),function(e){d.push(e)}(S);onKeyDown("left",(()=>{h.left=!0})),onKeyRelease("left",(()=>{h.left=!1})),onKeyDown("right",(()=>{h.right=!0})),onKeyRelease("right",(()=>{h.right=!1})),onKeyDown("up",(()=>{m()})),onUpdate((()=>{h.left?p.move(-200,0):h.right&&p.move(200,0)}));add([pos(1020,25),scale(1.7),sprite("moneda"),area(),fixed()]);const y=add([text(monedas),{value:"score"},pos(1060,20),scale(.5),area(),fixed()])})),scene("estadoFinal",(({score:e,estado:o})=>{let a;if("Game Over"===o){a=7e3;play("nivelPerdido",{volume:.5})}else if("Ganaste"===o){a=6e3;play("nivelGanado",{volume:.5})}add([text(o,32),origin("center"),pos(width()/2.1,height()/3.5)]),add([text("Puntaje:"),origin("center"),pos(width()/2.1,height()/3.5+80)]),add([text(e,32),origin("center"),pos(width()/2.1,height()/3.5+160)]);setTimeout((function(){let e=localStorage.getItem("elJugador");localStorage.removeItem(e),localStorage.setItem(e,monedas),location.href="index.html"}),a)})),go("game")}